<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Repository Dashboard - {{ repo.repo_full_name }}</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    /* Styling for chart placeholders */
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <h1>Repository Dashboard</h1>
  <h3>{{ repo.repo_full_name }}</h3>
  
  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="stats-tab" data-toggle="tab" href="#stats" role="tab"
         aria-controls="stats" aria-selected="true">Statistics</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="pr-tab" data-toggle="tab" href="#pr-list" role="tab"
         aria-controls="pr-list" aria-selected="false">Pull Requests</a>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="dashboardTabsContent">
    <!-- Statistics Tab -->
    <div class="tab-pane fade show active" id="stats" role="tabpanel" aria-labelledby="stats-tab">
      <div class="mt-3">
        <!-- Overall Stats Cards (dummy data, replace as needed) -->
        <div class="row">
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-header">Total PRs Analyzed</div>
              <div class="card-body">
                <h2 class="card-title">{{ stats.total_prs }}</h2>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-header">Total Smells Detected</div>
              <div class="card-body">
                <h2 class="card-title">{{ stats.total_smells }}</h2>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-header">Most Common Smell</div>
              <div class="card-body">
                <h2 class="card-title">{{ stats.most_common_smell }}</h2>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Charts -->
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="chart-container">
              <canvas id="barChart"></canvas>
            </div>
          </div>
          <div class="col-md-6">
            <div class="chart-container">
              <canvas id="pieChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Pull Requests Tab -->
    <div class="tab-pane fade" id="pr-list" role="tabpanel" aria-labelledby="pr-tab">
      <div class="mt-3">
        <!-- PR List Table (dummy data, replace as needed) -->
        <table class="table table-striped">
          <thead>
            <tr>
              <th>PR Number</th>
              <th>Title</th>
              <th>Smells Detected</th>
              <th>Top Smell</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for pr in pr_list %}
            <tr>
              <td>{{ pr.pr_number }}</td>
              <td>{{ pr.title }}</td>
              <td>{{ pr.smell_count }}</td>
              <td>{{ pr.top_smell }}</td>
              <td>
                <a href="{{ url_for('repo_routes.pr_analysis', repo_id=repo.internal_id, pr_number=pr.pr_number) }}" class="btn btn-primary btn-sm">
                  View Analysis
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center">No pull requests available.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Link to Repository Settings -->
  <div class="mt-4">
    <a href="{{ url_for('repo_routes.repo_settings', repo_id=repo.internal_id) }}" class="btn btn-secondary">Repository Settings</a>
  </div>
  
  <!-- Back to Main Dashboard -->
  <div class="mt-2">
    <a href="{{ url_for('main.main_page') }}" class="btn btn-outline-primary">Back to Main Dashboard</a>
  </div>
</div>

<!-- Include Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Dummy data for charts; replace with dynamic data as needed.
var barData = {
  labels: ["Vague", "Misleading", "Obvious", "Beautification", "Commented-Out Code", "Attribution", "Too Much", "Non-Local", "No Comment", "Task"],
  datasets: [{
    label: "Smell Frequency",
    data: [3, 5, 2, 4, 1, 3, 2, 2, 1, 4],
    backgroundColor: 'rgba(54, 162, 235, 0.6)',
    borderColor: 'rgba(54, 162, 235, 1)',
    borderWidth: 1
  }]
};

var barOptions = {
  scales: {
    y: { beginAtZero: true }
  }
};

var barCtx = document.getElementById('barChart').getContext('2d');
new Chart(barCtx, {
  type: 'bar',
  data: barData,
  options: barOptions
});

var pieData = {
  labels: barData.labels,
  datasets: [{
    label: "Smell Distribution",
    data: barData.datasets[0].data,
    backgroundColor: [
      'rgba(255, 99, 132, 0.6)',
      'rgba(54, 162, 235, 0.6)',
      'rgba(255, 206, 86, 0.6)',
      'rgba(75, 192, 192, 0.6)',
      'rgba(153, 102, 255, 0.6)',
      'rgba(255, 159, 64, 0.6)',
      'rgba(199, 199, 199, 0.6)',
      'rgba(83, 102, 255, 0.6)',
      'rgba(255, 99, 132, 0.6)',
      'rgba(54, 162, 235, 0.6)'
    ],
    borderWidth: 1
  }]
};

var pieCtx = document.getElementById('pieChart').getContext('2d');
new Chart(pieCtx, {
  type: 'pie',
  data: pieData
});
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
