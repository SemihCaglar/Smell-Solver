<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PR Analysis - PR #{{ pr_details.pr_number }}</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .smell-table td, .smell-table th {
      vertical-align: middle;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <h1>PR Analysis</h1>
  <div class="mb-3">
    <h2>PR #{{ pr_details.pr_number }}: {{ pr_details.title }}</h2>
    <p>
      <strong>Status:</strong> {{ pr_details.status }}<br>
      <strong>Created At:</strong> {{ pr_details.created_at }}<br>
      <strong>Updated At:</strong> {{ pr_details.updated_at }}
    </p>
  </div>

  <h3>Detected Comment Smells</h3>
  {% if pr_details.smell_details %}
  <table class="table table-bordered smell-table">
    <thead class="thead-light">
      <tr>
        <th>File</th>
        <th>Line</th>
        <th>Smell Type</th>
        <th>Original Comment</th>
        <th>Suggested Fix</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for smell in pr_details.smell_details %}
      <tr>
        <td>{{ smell.file }}</td>
        <td>{{ smell.line }}</td>
        <td>{{ smell.smell_type }}</td>
        <td>{{ smell.original }}</td>
        <td>{{ smell.suggested }}</td>
        <td>{{ smell.status }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No comment smells detected for this PR.</p>
  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('repo_routes.repo_dashboard', repo_id=repo_id) }}" class="btn btn-secondary">Back to Repository Dashboard</a>
    {% if pr_details.github_pr_url %}
    <a href="{{ pr_details.github_pr_url }}" target="_blank" class="btn btn-primary">Open PR on GitHub</a>
    {% endif %}
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
